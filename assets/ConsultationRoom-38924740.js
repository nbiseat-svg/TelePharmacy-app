import{j as e}from"./index-a78a0123.js";import{d as R,u as L,r as s}from"./vendor-d9bade96.js";import{a as V}from"./redux-e3095c52.js";import{C as H}from"./consultationService-3b114586.js";import{m as P}from"./animations-c3d91ae5.js";import"./i18n-b264d0aa.js";import"./axios-edfcd65b.js";const Z=()=>{const{id:h}=R(),r=L();V(t=>t.auth.user);const[n,l]=s.useState([]),[d,p]=s.useState(""),[i,N]=s.useState(!0),[o,f]=s.useState(!0),[c,S]=s.useState(!1),[m,y]=s.useState("connecting"),[a,b]=s.useState(null),[C,x]=s.useState(!0),[v,g]=s.useState(""),j=s.useRef(null),k={id:h,patient:{name:"John Doe",avatar:"/src/assets/patient-avatar.jpg"},pharmacist:{name:"Dr. Sarah Williams",avatar:"/src/assets/pharmacist-avatar.jpg",specialization:"Clinical Pharmacy"},type:"video",scheduledAt:"2025-09-20T10:00:00Z",duration:30},D=[{id:1,sender:"pharmacist",text:"Hello John, I see you requested a consultation. How can I help you today?",timestamp:"10:00 AM"},{id:2,sender:"patient",text:"Hi Dr. Williams, I've been experiencing some side effects from my new medication.",timestamp:"10:01 AM"},{id:3,sender:"pharmacist",text:"I understand. Can you tell me more about the side effects you're experiencing?",timestamp:"10:02 AM"}];s.useEffect(()=>{(async()=>{try{setTimeout(()=>{b(k),l(D),y("active"),x(!1)},2e3)}catch(u){g(u.message),x(!1)}})()},[h]),s.useEffect(()=>{A()},[n]);const A=()=>{var t;(t=j.current)==null||t.scrollIntoView({behavior:"smooth"})},T=async t=>{if(t.preventDefault(),d.trim()==="")return;const u={id:n.length+1,sender:"patient",text:d,timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};l([...n,u]),p(""),setTimeout(()=>{const B={id:n.length+2,sender:"pharmacist",text:"Thank you for sharing that. Based on what you've described, I recommend adjusting your dosage.",timestamp:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})};l($=>[...$,B])},2e3)},w=()=>{N(!i)},I=()=>{f(!o)},M=()=>{S(!c)},E=async()=>{try{alert("Consultation ended successfully"),r("/consultation/book")}catch(t){g(t.message)}};return C?e.jsx("div",{className:"consultation-room-page",children:e.jsxs("div",{className:"loading-container",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading consultation room..."})]})}):v?e.jsx("div",{className:"consultation-room-page",children:e.jsxs("div",{className:"error-container",children:[e.jsxs("p",{children:["Error: ",v]}),e.jsx("button",{className:"btn-primary",onClick:()=>r("/consultation/book"),children:"Back to Booking"})]})}):a?e.jsx(P.div,{className:"consultation-room-page",initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:e.jsxs("div",{className:"consultation-room-container",children:[e.jsxs("div",{className:"consultation-header",children:[e.jsxs("div",{className:"consultation-info",children:[e.jsxs("h2",{children:["Consultation with ",a.pharmacist.name]}),e.jsx("p",{children:a.pharmacist.specialization})]}),e.jsx("div",{className:"consultation-status",children:e.jsx("span",{className:`status ${m}`,children:H.getStatusDisplayText(m)})})]}),e.jsxs("div",{className:"consultation-content",children:[e.jsxs("div",{className:"video-section",children:[e.jsx("div",{className:"video-container",children:m==="connecting"?e.jsxs("div",{className:"connecting",children:[e.jsxs("p",{children:["Connecting to ",a.pharmacist.name,"..."]}),e.jsx("div",{className:"spinner"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"remote-video",children:[e.jsx("img",{src:a.pharmacist.avatar,alt:"Pharmacist"}),e.jsx("div",{className:"participant-name",children:a.pharmacist.name})]}),e.jsxs("div",{className:"local-video",children:[e.jsx("img",{src:a.patient.avatar,alt:"You"}),e.jsx("div",{className:"participant-name",children:"You"})]})]})}),e.jsxs("div",{className:"video-controls",children:[e.jsx("button",{className:`control-button ${o?"active":""}`,onClick:I,title:o?"Mute":"Unmute",children:o?"🔊":"🔇"}),e.jsx("button",{className:`control-button ${i?"active":""}`,onClick:w,title:i?"Turn off video":"Turn on video",children:i?"📷":"🚫"}),e.jsx("button",{className:`control-button ${c?"active":""}`,onClick:M,title:c?"Stop sharing":"Share screen",children:c?"🖥️":"💻"}),e.jsx("button",{className:"control-button end-call",onClick:E,title:"End consultation",children:"📞"})]})]}),e.jsxs("div",{className:"chat-section",children:[e.jsxs("div",{className:"messages-container",children:[n.map(t=>e.jsxs("div",{className:`message ${t.sender}`,children:[e.jsx("div",{className:"message-avatar",children:e.jsx("img",{src:t.sender==="patient"?a.patient.avatar:a.pharmacist.avatar,alt:t.sender})}),e.jsxs("div",{className:"message-content",children:[e.jsx("div",{className:"message-text",children:t.text}),e.jsx("div",{className:"message-time",children:t.timestamp})]})]},t.id)),e.jsx("div",{ref:j})]}),e.jsxs("form",{onSubmit:T,className:"message-form",children:[e.jsx("input",{type:"text",value:d,onChange:t=>p(t.target.value),placeholder:"Type your message..."}),e.jsx("button",{type:"submit",className:"send-button",children:"Send"})]})]})]})]})}):e.jsx("div",{className:"consultation-room-page",children:e.jsxs("div",{className:"error-container",children:[e.jsx("p",{children:"Consultation not found"}),e.jsx("button",{className:"btn-primary",onClick:()=>r("/consultation/book"),children:"Back to Booking"})]})})};export{Z as default};
